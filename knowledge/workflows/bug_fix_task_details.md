[← ワークフローへ戻る](./workflow.md)

# バグ修正タスク詳細

## 概要

バグ修正ストーリーは、バグを恒久的に修正し副作用を最小化するために、「再現」と「予防」を明示的に重視します。

## タスクリスト

1. [分析 & 計画](#1-分析--計画)
2. [再現テストの作成](#2-再現テストの作成)
3. [修正の実装](#3-修正の実装)
4. [修正確認（テスト）](#4-修正確認テスト)
5. [副作用確認](#5-副作用確認)
6. [ドキュメント更新](#6-ドキュメント更新)
7. [完了条件の検証](#7-exit-criteria-の検証)

---

### 1. 分析 & 計画

**成果物**: バグ分析の Issue コメント / 計画

**ゴール**: 根本原因を特定し、修正アプローチを決定する。

**作業内容**:

- 報告されたバグを分析する。
- （可能なら）手動でバグを再現する。
- 根本原因を特定する。
- 修正計画を立てる。
  - **テンプレート**: [バグ修正ストーリー](../templates/issues/story_bug_fix.md)
  - **テンプレート**: [バグ修正計画](../templates/agents/bug_fix_plan.template.md)（詳細分析に使用）

**チェックポイント**:

- [ ] [バグ修正ストーリー](../templates/issues/story_bug_fix.md) を用いて確認する。

---

### 2. 再現テストの作成

**成果物**: テストコード（Git）

**ゴール**: 再現を自動化し、バグが修正され二度と戻らないことを保証する（回帰テスト）。

**作業内容**:

- バグにより失敗するテストケースを書く。
- 失敗するテスト（Red 状態）をコミットする。

**チェックポイント**:

- [ ] テストケースがバグを再現する（想定どおり失敗する）。
- [ ] テストコードが Git にコミットされている。

---

### 3. 修正の実装

**成果物**: ソースコード（Git）

**ゴール**: バグを修正する。

**作業内容**:

- バグを修正するためにソースコードを変更する。
- 必要ならリファクタリングする（安全性を確保する）。
  - **テンプレート**: [実装タスク](../templates/issues/task_implementation.md)

**チェックポイント**:

- [ ] [実装タスク](../templates/issues/task_implementation.md) を用いて確認する。

---

### 4. 修正確認（テスト）

**成果物**: テスト結果（Pass）

**ゴール**: 再現テストによりバグが修正されたことを確認する。

**作業内容**:

- 再現テストを実行する。
- Pass するか確認する（Green 状態）。
  - **テンプレート**: [機能テストタスク](../templates/issues/task_test_functional.md)

**チェックポイント**:

- [ ] [機能テストタスク](../templates/issues/task_test_functional.md) を用いて確認する。

---

### 5. 副作用確認

**成果物**: 副作用確認結果（Issue コメント）

**ゴール**: システムの他部分が壊れていないことを保証する。

**作業内容**:

- （重要/影響大なら）サニティテストを実行する。
- 関連する機能テストを実行する。
- 影響範囲周辺で手動の探索的テストを行う。

**チェックポイント**:

- [ ] 副作用が観測されない。
- [ ] （実行した場合）サニティテストが通る。

---

### 6. ドキュメント更新

**成果物**: 更新されたドキュメント（Git）

**ゴール**: ドキュメントとコード挙動の整合性を保つ。

**作業内容**:

- 修正が挙動/ロジックを変えた場合、仕様/設計を更新する。
- 必要なら CHANGELOG を更新する。
- 関連があれば TROUBLESHOOTING や KNOWN_ISSUES を更新する。

**チェックポイント**:

- [ ] ドキュメントが修正内容を反映している。
- [ ] CHANGELOG が更新されている。

---

### 7. 完了条件の検証

**成果物**: プロジェクト管理ツール上の検証記録

**ゴール**: バグ修正ストーリーが完了したことを確認する。

**作業内容**:

- 完了条件に基づき最終チェックを行う。
  - **テンプレート**: [完了条件の検証](../templates/issues/task_verify_exit_criteria.md)
- すべての成果物が Git にあることを確認する。
- Issue をクローズする。

**チェックポイント**:

- [ ] [完了条件の検証](../templates/issues/task_verify_exit_criteria.md) を用いて確認する。
