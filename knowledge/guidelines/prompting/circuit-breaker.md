# Stop and Ask（サーキットブレーカー）

## 問題

エージェントは、エラーを見る → 推測で修正する → またエラーを見る → 繰り返す、というループにハマることがあります。あるいは、弱い仮定に基づいた修正を進めてしまい、それが誤りだと判明して時間を浪費し、場合によってはコードを破壊する可能性もあります。

## 解決策

根本原因を検証できない場合、または複数回失敗した場合は、エージェントに **STOP** してユーザーに **ASK** することを明示的に指示します。

## 実装手順

1.  **停止条件を定義する**:
    合理的な試行回数（例: 3 回）や、特定の不確実性トリガー（例:「再現できない」）を決めます。

2.  **「制約」または「停止条件」セクションを追加する**:
    プロンプトまたはエージェントテンプレートに、「修正せよ」という命令より優先される明確なルールを追加します。

## テンプレ例

```markdown
## ⛔ 停止条件

**3 回の試行**の後でも根本原因を特定できない場合、または修正が未検証の仮定を必要とする場合:

1.  実行を **停止（STOP）** してください。
2.  これまでの調査結果と試行した内容を **報告（Report）** してください。
3.  さらなるガイダンスや詳細情報について、ユーザーに **質問（Ask）** してください。
```

## 利点

- **効率（Efficiency）**: 悪い経路にトークンと時間を費やす「空回り（flailing）」を防ぎます。
- **安全性（Safety）**: ハルシネーションによる「修正」が状況を悪化させる可能性を低減します。
- **協働（Collaboration）**: 必要なタイミングで人間をループに戻します。
