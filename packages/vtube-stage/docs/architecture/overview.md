<!-- This document is generated and updated by .github/prompts/doc-sync.prompt.md -->

# アーキテクチャ概要

## システム概要

`vtube-stage` は、AI V-Tuber システムのフロントエンドコンポーネントです。このアプリケーションは、VRM モデルのレンダリング、アニメーション制御、表情の更新、および配信画面に必要な情報の表示を担当します。

主な目的は、`vtuber-behavior-engine` (MCP クライアント) から送信されるリアルタイムコマンドを視覚的なアクションに変換し、OBS Studio などの配信ソフトウェアでキャプチャ可能な高品質な映像を提供することです。

## 主要コンポーネント

- **VRM レンダラー (`VRMAvatar`)**: Three.js と `@pixiv/three-vrm` を使用して VRM モデルを 3D 空間に描画します。
- **コマンドハンドラー (`useStageCommandHandler`)**: WebSocket 経由で受信したコマンドを解析し、適切なアクション（表情変更、ポーズ変更、発話など）を実行します。
- **アニメーションシステム**: VRM アニメーション (`.vrma`) を使用して、待機ポーズや特定のアクションを実行します。
- **TTS 連携 (`tts_service`)**: 音声合成エンジンと連携し、キャラクターの発話とリップシンクを実現します。
- **UI オーバーレイ**: 字幕、吹き出し (`SpeechBubble`)、ステータス情報などを 3D シーンの上に重ねて表示します。
- **カメラ制御 (`AnimatedCamera`)**: コマンドに基づいてカメラの視点やズームを動的に制御します。

## 設計方針

- **リアルタイム性**: WebSocket を使用した低遅延なコマンド処理。
- **拡張性**: 新しい表情やアニメーションを簡単に追加できる構造。
- **配信最適化**: OBS でのクロマキー合成や透過キャプチャを考慮した画面設計。
