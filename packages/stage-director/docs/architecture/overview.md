<!-- このドキュメントは .github/prompts/doc-sync.prompt.md によって生成・更新されています -->

# アーキテクチャ概要

## システム概要

`stage-director` は、AI V-Tuber システムにおける「舞台監督」の役割を果たすコンポーネントです。AI エージェント（`vtuber-behavior-engine`）からの高レベルな指示を受け取り、それをリアルタイムレンダリングエンジン（`vtube-stage`）が理解できる具体的なコマンドに変換・送信します。

## 主要コンポーネント

- **MCP サーバー (FastMCP)**: AI エージェントに対してツール（`speak`, `trigger_animation` 等）を提供します。
- **FastAPI / WebSocket サーバー**: `vtube-stage` とのリアルタイム通信を管理します。
- **コマンドキュー**: AI からの指示を順序立てて処理し、実行状態を管理します。
- **同期マネージャー**: 音声合成（TTS）の完了イベント（`speakEnd`）を待機し、AI の発話タイミングを制御します。

## 設計方針

- **疎結合**: MCP を介することで、AI コアとレンダリングエンジンの実装を分離します。
- **リアルタイム性**: WebSocket を使用し、低遅延でコマンドを送信します。
- **信頼性**: コマンドに UUID を付与し、実行完了を追跡します。
