# カスタム命令更新プロンプト作成

**日時:** 2025 年 11 月 26 日  
**目的:** GitHub Copilot のカスタム命令（`copilot-instructions.md` と `*.instructions.md`）を作成・更新するためのプロンプトファイルを作成する

---

## 概要

GitHub Copilot のカスタム命令を効率的に作成・更新できるプロンプトファイルを作成しました。VS Code のカスタム命令公式ドキュメントと `agents-docs/*` のプロジェクト情報を活用し、以下のファイルを生成しました：

1. **プロンプトファイル**: `.github/prompts/update-copilot-instructions.prompt.md`
2. **言語別命令ファイル**: `.github/instructions/` 配下に 3 つの `.instructions.md` ファイル
3. **メイン命令ファイル**: `.github/copilot-instructions.md` の更新

---

## 対話の流れ

### 1. 最初の質問・依頼

ユーザーから `create-custom-prompt.prompt.md` のプロンプトに従い、GitHub Copilot のカスタム命令を作成・更新するためのプロンプトを作成するよう依頼を受けた。

**要件:**

- 必ず最初に `https://code.visualstudio.com/docs/copilot/customization/custom-instructions` を fetch する
- `agents-docs/*` のファイルを読みプロジェクト全体の情報を把握する
- `copilot-instructions.md` を作成する（重要情報は直接記載、詳細はリンク）
- 言語別のルールは `*.instructions.md` を利用する

**Copilot の応答:**

1. 公式ドキュメントを fetch してカスタム命令の最新仕様を取得
2. `agents-docs/*` の全ファイル（7 つ）を並列で読み込み
3. 既存の `copilot-instructions.md` の内容を確認
4. `.github/` ディレクトリの構造を確認

### 2. ファイル作成・更新

**作成したファイル:**

1. `.github/prompts/update-copilot-instructions.prompt.md`

   - カスタム命令を更新するためのプロンプトファイル
   - 公式ドキュメント取得 → プロジェクト情報収集 → ファイル生成の手順を定義

2. `.github/instructions/python.instructions.md`

   - `applyTo: "**/*.py"` で Python ファイルに自動適用
   - 型ヒント、非同期プログラミング、Pydantic モデル、ADK エージェント規約

3. `.github/instructions/test.instructions.md`

   - `applyTo: "**/tests/**/*.py"` でテストファイルに自動適用
   - pytest、モック、非同期テスト、AAA パターン

4. `.github/instructions/prompt.instructions.md`

   - `applyTo: "**/resources/**/*.md"` でプロンプトテンプレートに自動適用
   - プレースホルダー形式、構造化出力

5. `.github/copilot-instructions.md`（更新）
   - プロジェクト概要、技術スタック、アーキテクチャ概要
   - 開発ワークフロー、コーディング規約、環境変数
   - `agents-docs/*` へのリンク、よくあるトラブル

### 3. パス修正

Markdown リンクのパスが `.github/` からの相対パスになっていなかったため、`agents-docs/` を `../agents-docs/` に修正。

---

## 重要なポイント

- **コンテキストの与え方:**

  - 既存のプロンプトファイル（`create-custom-prompt.prompt.md`）を参照して構造化された要件を伝達
  - ルールを明確に列挙（重要情報は直接記載、リンクとの重複を許容など）

- **効果的だった指示:**

  - 「公式ドキュメントを最初に fetch する」という明確な手順
  - `agents-docs/*` という対象ファイルの明示
  - `*.instructions.md` の `applyTo` パターンによるファイルタイプ別の適用

- **改善点:**
  - リンクパスの相対パス指定（`.github/` からの相対パス）を最初から考慮すべきだった

---

## 成果物

### 作成したファイル構造

```
.github/
├── copilot-instructions.md          # メイン命令（更新）
├── instructions/
│   ├── python.instructions.md       # Python 規約
│   ├── test.instructions.md         # テスト規約
│   └── prompt.instructions.md       # プロンプト規約
└── prompts/
    └── update-copilot-instructions.prompt.md  # 更新用プロンプト
```

### カスタム命令の構成

- **copilot-instructions.md**: プロジェクト全体に自動適用される基本ガイドライン
- **python.instructions.md**: `**/*.py` に適用される Python 詳細規約
- **test.instructions.md**: `**/tests/**/*.py` に適用されるテスト規約
- **prompt.instructions.md**: `**/resources/**/*.md` に適用されるプロンプト規約

---

## 学んだこと・Tips

- **カスタム命令のベストプラクティス**:

  - 重要情報は `copilot-instructions.md` に直接記載する（Copilot がリンク先を読む保証がないため）
  - 言語・ファイルタイプ別の詳細規約は `*.instructions.md` で分離
  - `applyTo` のグロブパターンで適用範囲を制御

- **公式ドキュメントの活用**:

  - VS Code の公式ドキュメントを fetch して最新の仕様を確認することで、正確な形式でファイルを生成できる

- **階層的なドキュメント構造**:
  - `agents-docs/*` に詳細ドキュメントを配置し、`copilot-instructions.md` からリンクする構造が効果的

---

## タグ

`#GitHub-Copilot` `#カスタム命令` `#vtuber-behavior-engine` `#ドキュメント整備` `#プロンプトエンジニアリング`
